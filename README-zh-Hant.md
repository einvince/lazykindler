# Lazy Kindler
<br>

<!-- ![cooltext400798739959192](https://user-images.githubusercontent.com/16133390/147348820-9db84863-9431-4e67-814c-f1e1ddde8372.png) -->

<img src="./header.svg" width="800" height="400" alt="Click to see the source">


# ✨ 特性

- 🌈 書籍導入，並以高效的方式展示書籍列表。
- 💅 創建合集，比如科幻小說集合、武俠小說集合。
- 🚀 多維度展示，可以從書名、作者、評分、集合、標籤等多維度展示書籍列表。
- 🛡 搜索書籍，可以從書名、作者、出版社等任何一個關鍵詞搜索相關書籍。
- 📦 下載書籍，可以右鍵菜單下載書籍，也可以下載平台管理的所有書籍。
- 🛡 書籍閱讀，平台支持書籍閱讀功能。
- 📦 備份功能，平台數據庫採用了 `sqlite3`，並且所有書籍都放在了指定目錄，十分適合備份。
- 🎻 高亮筆記，電腦連接 `kindle` 後，平台可以自動導入高亮筆記。
- 📣 高亮筆記，安卓平台支持導入 `靜讀天下apk` 導出的筆記文件。
- 🎺 高亮筆記，支持對導入平台的高亮筆記做`二次高亮`、`二次高亮刪除`。
- 🥁 高亮筆記，平台支持對高亮筆記添加評論。
- 🎻 高亮筆記，可以創建集合並對高亮筆記進行分類管理。
- 🚀 kindle生詞本，"生詞本"是kindle的一個功能, 平台支持導入kindle生詞本中的書籍、單詞和用例。

# 支持的平台

目前只適配了 `mac` 平台，在 `windows` 平台運行會有未知錯誤。

# 支持的電子書類型

mobi 和 azw3。其他類型的電子書在導入時會自動被忽略。

# 解決的問題

從網上下載了**數千本**電子書以後，如何高效的管理這些電子書？
<br />
各種電子書的質量參差不齊，有普通作家寫的，也有世界大文豪寫的。種類也很多，有科幻類、言情類、玄幻類型等等。
<br />
如果每次找書都在一個包含了幾千本書的目錄裡查找，想想都腦袋疼。因此有必要對這些電子書使用恰當的方式管理起來，方便我們使用特定的偏好在一個小範圍裡查找電子書，從而快速找到希望尋找的書籍，避免浪費過多查找時間。
<br />
lazykindler因此橫空出世。

# 功能介紹

## 1. 書籍導入

點擊`上傳文件`按鈕，平台將遞歸掃描 `~/Download`、`~/下載`、`~/Desktop`、`~/桌面` 等目錄下受支持的電子書文件。相同文件不會重複上傳。
<br />
目前僅支持導入 `mobi` 和 `azw3` 格式的電子書, 平台不提供電子書格式轉換功能。其實要找指定格式的電子書很容易，我一般在這個網站找電子書 http://www.fast8.com 。 這個網站的好處是書籍全，同時下載時提供了多種格式選擇，直接下載指定格式的書籍即可。

## 2. 給書籍添加元數據
可以對書籍執行 修改評分、標籤、集合、作者、出版社、封面 等操作。需要注意的是這些操作並不會真正去修改書籍文件本身，而是在數據庫添加記錄。

## 3. 書籍信息解析

導入電子書以後，平台會自動從電子書文件里提取數據用於信息展示和書籍管理。

## 4. 集合

可以創建書籍的集合，比如 `科幻小書集合`、`奇幻小說集合`、`言情小說集合`等等，並給集合添加自己喜歡的有代表性的封面，可以給集合`打分`、`添加標籤`。每個集合都可以從書庫中選擇並添加書籍，還可以對集合進行打分、添加標籤、添加封面等等操作。當我們有了多個集合，以後可以直接從這些集合中尋找書籍。

## 5. 展示

為了支持從不同維度展示書籍，我們可以給書籍`打分`和`添加標籤`，還可以`修改作者`以及`修改出版社`，書籍可以從`評分`、`標籤`、`作者`、`出版社`等不同維度進行展示。另外還可以`修改書籍封面`。

## 6. 下載

平台裡的書籍都可以在書籍卡片的`操作`裡點擊`下載`，然後書籍會被下載並存放到用戶主目錄的 `下載` 或者 `Download`。在平台首頁點擊`下載所有書籍`會把書籍下載到用戶主目錄的`文稿` 或者 `Documents`下的 `lazykindler`目錄。多次點擊`下載所有書籍`並不會重複下載已經存在的書籍。

## 7. 閱讀

平台提供了閱讀書籍的基本功能。目前我沒有找到使用 `reactjs` 實現的閱讀`mobi`和`azw3`這兩種格式電子書的庫，因此在第一次點擊`閱讀書籍`的按鈕時，平台會把這兩種格式轉換為 `epub`格式，使用的工具是 `/Applications/calibre.app/Contents/MacOS/ebook-convert`，因此使用平台時要求電腦要安裝 `calibre`，否則閱讀書籍功能將無法正常工作。只有在第一次點擊`閱讀書籍`時涉及格式轉換，此時頁面可能出現短暫的無法響應的問題，這是正常的，等待時間和電子書大小相關，一般都很快，後面再次打開就快了。轉換後的書籍被存放到了平台主目錄下的 `backend/data`。
<br />

## 8. 處理流程

在 `書籍 -> 書庫` 頁面下展示的書籍屬於正式存儲的書籍，剛導入的書籍會被展示在 `書籍 -> 臨時` 頁面。(除了頁面上位置的區分，正式的和臨時的書籍在後台沒有多大區別)。
<br />
`臨時`書籍被添加到任意集合以後，會從`書籍 -> 臨時` 轉移到 `書籍 -> 書庫` 。這樣做的目的是**區分正式存儲的書籍和臨時導入的書籍。正式存儲的書籍經過了篩選，刪掉了不喜歡的書籍，並且進行了分類，而臨時導入的書籍一般五花八門。**


## 9. 備份

資料庫採用的是 `sqlite3`，位置在 `backend/lazykindler.db`。

<br />

初次啟動平台時，會自動建立並初始化該資料庫檔案。該檔案包含了平台除書籍外的其餘所有資料訊息。往平台匯入的書籍被複製到了 `backend/data` 目錄下。需要注意的是，為了方便平台內部操作，`backend/data` 目錄下的書籍名後面都被添加了 書籍的 `md5`值。

<br />

如果要對平台裡所有書籍以及資料進行備份，只需要保存 `backend/lazykindler.db` 和 `backend/data` ，下次在其他地方啟動服務前，把 `backend/lazykindler.db` 和 `backend/data` 複製到對應位置即可。

## 10. 匯入 kindle 高亮筆記

這個功能目前只支援 mac 平臺。

<br />

平臺會自動偵測 Kindle 是否連接，Kindle 連接電腦後，平臺會把 Kindle 的 My Clippings.txt 匯入到系統中用於統一管理和多維度展示。當 Kindle 的 My Clippings.txt 檔案發生變化，平臺會自動匯入 My Clippings.txt 裡新增的部分，舊的資料不會重複匯入。用戶只要在電腦連接 Kindle 後刷新一下頁面就可以看到新增內容了。

<br />

需要指出的是，Kindle 會把用戶添加的高亮筆記處理成一塊沒有換行的文字，即使這是多個段落的內容。`layerkindler` 通過巧妙地方式，在匯入 Kindle 的 My Clippings.txt 檔案時，自動識別並進行了換行處理。

<img src="https://user-images.githubusercontent.com/16133390/210229975-4e7145e7-5d91-4aff-85ff-f5550fd7fe2c.png" width="66%">

## 11. 對高亮筆記進行二次高亮操作

高亮筆記是我們在閱讀書籍時對有感觸的文字進行高亮操作後記錄下來的部分文字或者相關段落，往往是因為其中一句話或者一個詞對我們有某種觸動。當我們把高亮筆記匯入平台後，在後期整理時，有必要對當時引起你共鳴的句或詞進行高亮操作，方便高亮顯示引起你共鳴那一小段文字。

<br />

使用 `lazykindler`，您可以很輕易地做二次高亮操作。只要選中相關文字，接著在自動彈出的對話框裡點擊 `確定` 即可。

<img src="https://user-images.githubusercontent.com/16133390/210230077-c9a4532b-aafc-4ba2-a163-cd151c98d831.png" width="66%">

## 12. 對高亮筆記添加評論

可以記錄一下引起你共鳴的這段文字的一些想法。
<img width="1379" alt="Xnip2023-02-05_15-19-18" src="https://user-images.githubusercontent.com/16133390/216806787-4b76a541-608d-4e8e-9d8e-2651bf7842ef.png">


## 13. 導入靜讀天下apk的高亮筆記

「靜讀天下apk」是一款在安卓平台上相當流行的閱讀器，目前我使用這款軟體在海信閱讀器上看書，該軟體也支援添加高亮筆記。因此我對該軟體高亮筆記的導入也做了支援。

<br />

從「靜讀天下apk」匯出的高亮筆記檔案格式為`.mrexpt`。將該檔案放在`~/Download`、`~/下載`、`~/Desktop`、`~/桌面 `等任何一個目錄下，平台可以自動完成導入操作。

## 14. 導入kindle生字本

生字本是Kindle中的一項功能，用於紀錄閱讀過程中查詢過的單字或者詞語，通過這種方式閱讀英文原版書籍並紀錄單字，後續可以用來學習和復習這些單字。平台支持匯入這些生字。

在支持匯入這些生字基礎上，平台提供了良好的界面用於展示這些信息，還可以手動創建生字和用例，同時可以給用例增加翻譯。

<img width="1322" alt="Xnip2023-03-31_23-23-41" src="https://user-images.githubusercontent.com/16133390/229163528-952ee43f-bf31-43a7-b39b-98d637e584da.png">

<img width="1320" alt="Xnip2023-03-31_23-23-57" src="https://user-images.githubusercontent.com/16133390/229163550-8c321a41-7df4-41af-9bd0-fd765e113a1f.png">

# 運行環境要求

`python 3.10.4`

`nodejs v19.6.0`

`Calibre`

其他版本未經測試

# 啟動服務

## 安裝依賴

1. 在 `backend` 目錄執行

```

pip3 install -r requirements.txt

```

2. 如果需要使用 `chatgpt` 功能，請在 `backend/config.ini` 中配置 `chatgpt` 的 key。OpenAi 官網生成key的地址是 `https://platform.openai.com/account/api-keys`.

3. 在 `frontend` 目錄執行

```

yarn install

```

## 啟動服務

```

./start.sh

```

然後瀏覽器訪問 http://localhost:8000.

## 停止服務

```

./stop.sh

```

## 注意事項

平台僅為個人設計，沒有登錄註冊等功能。

# 平台展示

下面是我本地自己上傳了書籍並配置了集合後的截圖

<img width="1418" alt="1" src="https://user-images.githubusercontent.com/16133390/216806475-97ee4960-40cc-4649-b414-0687724bb6ad.png">
<br />
<img width="1398" alt="Xnip2023-02-05_15-13-49" src="https://user-images.githubusercontent.com/16133390/216806612-dc1baf4f-7ed5-4b3d-ab44-73c7f07c73a7.png">
<br />
<img width="1418" alt="2" src="https://user-images.githubusercontent.com/16133390/216806480-def76f45-f8ba-41fc-9512-a448e9fbce32.png">
<br />
<img width="1418" alt="3" src="https://user-images.githubusercontent.com/16133390/216806485-caf74fe2-0cef-45f8-9a29-47780e72132d.png">
<br />
<img width="1799" alt="Xnip2023-02-14_12-36-20" src="https://user-images.githubusercontent.com/16133390/218640667-ba74048a-3b78-41c6-a772-dc1e56485b56.png">

<br />
<img width="1801" alt="Xnip2023-02-14_12-36-38" src="https://user-images.githubusercontent.com/16133390/218640680-263195c2-7ac3-4947-b7a5-b70375074e9c.png">

<br />

# 其他

在用於 `kindle` 的相關工具中，最有名的應該是 `calibre`。但這個軟體偏向於「編輯」功能，對於電子書的多面向展示相對簡陋。因此我打算自己開發一個能夠貼合實際需求、專門用來管理電子書的工具。

目前正在抽空開發中，如果您也喜歡看電子書並且對管理電子書有任何建議或想法，不妨提出 issue。

若有任何使用上的問題或者功能需求，請聯絡作者：郵箱 wupengcn301@gmail.com 或微信 leowucn。感謝！
